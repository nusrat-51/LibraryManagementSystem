@model LibraryManagementSystem.Models.StudentDashboardViewModel

@{
    ViewData["Title"] = "Student Dashboard";
    Layout = "_StudentLayout";
}

@if (TempData["MembershipMessage"] != null)
{
    <div class="sd-section-card" style="margin-top: 8px; background:#ecfdf5; border-color:#bbf7d0;">
        <span style="font-size:13px; color:#166534;">
            @TempData["MembershipMessage"]
        </span>
    </div>
}

<div class="sd-page">
    <div class="sd-container">
        <h1 class="sd-header-title">Student Dashboard</h1>
        <p class="sd-header-sub">
            Welcome, @Model.StudentName (@Model.Email)
        </p>

        <!-- Membership card -->
        <div class="sd-card-main">
            <div class="sd-membership-grid">
                <div>
                    <div class="sd-membership-title">Membership</div>

                    <p><strong>Email:</strong> @Model.Email</p>

                    <p>
                        <strong>Type:</strong>
                        @if (Model.MembershipType == "Premium")
                        {
                            <span class="sd-badge sd-badge-premium">Premium</span>
                        }
                        else
                        {
                            <span class="sd-badge sd-badge-standard">
                                @Model.MembershipType
                            </span>
                        }
                    </p>

                    <p>
                        <strong>Status:</strong>
                        @if (Model.IsMembershipActive)
                        {
                            <span class="sd-badge sd-badge-active">Active</span>
                        }
                        else
                        {
                            <span class="sd-badge sd-badge-inactive">Inactive</span>
                        }
                    </p>

                    @if (Model.MembershipType == "Standard")
                    {
                        <form asp-action="UpgradeToPremium"
                              asp-controller="Student"
                              method="post"
                              class="sd-upgrade-form">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="sd-btn-soft sd-btn-upgrade">
                                Upgrade to Premium
                            </button>
                        </form>
                    }
                </div>

                <div>
                    <div class="sd-barcode-box">
                        <div class="sd-barcode-label">Membership ID / Barcode</div>
                        <div class="sd-barcode-value">
                            @Model.MembershipBarcode
                        </div>
                        <div class="sd-expiry">
                            Expiry:
                            @if (Model.MembershipExpiry.HasValue)
                            {
                                @Model.MembershipExpiry.Value.ToString("dd MMM yyyy")
                            }
                            else
                            {
                                @:N/A
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats row -->
        <div class="sd-stats-row">
            <div class="sd-stat-card">
                <div class="sd-stat-label">Current Issued</div>
                <div class="sd-stat-value">@Model.CurrentIssuedCount</div>
            </div>

            <div class="sd-stat-card">
                <div class="sd-stat-label">Overdue</div>
                <div class="sd-stat-value sd-danger">@Model.OverdueCount</div>
            </div>

            <div class="sd-stat-card">
                <div class="sd-stat-label">Total Books</div>
                <div class="sd-stat-value">@Model.TotalBooksCount</div>
            </div>

            <div class="sd-stat-card">
                <div class="sd-stat-label">Unpaid Fine</div>
                <div class="sd-stat-value">
                    @Model.TotalUnpaidFine.ToString("0.00")
                </div>
            </div>
        </div>

        <!-- Recent Issued Books -->
        <div class="sd-section-card">
            <div class="sd-section-header">
                <div>
                    <div class="sd-section-title">Recent Issued Books</div>
                    <div class="sd-section-sub">
                        @if (Model.RecentIssues == null || !Model.RecentIssues.Any())
                        {
                            @:You have no issued books yet.
                        }
                        else
                        {
                            @:Last few books you borrowed.
                        }
                    </div>
                </div>
                <a asp-controller="Student"
                   asp-action="MyIssues"
                   class="sd-btn-soft">
                    View All
                </a>
            </div>

            @if (Model.RecentIssues == null || !Model.RecentIssues.Any())
            {
                <p>You have no issued books yet.</p>
            }
            else
            {
                <table class="sd-table">
                    <thead>
                        <tr>
                            <th>Book</th>
                            <th>Issued On</th>
                            <th>Status</th>
                            <th>Return Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var issue in Model.RecentIssues)
                        {
                            <tr>
                                <td>@issue.Book?.Title</td>
                                <td>@issue.IssueDate.ToString("dd MMM yyyy")</td>
                                <td>@issue.Status</td>
                                <td>
                                    @if (issue.ReturnDate.HasValue)
                                    {
                                        @issue.ReturnDate.Value.ToString("dd MMM yyyy")
                                    }
                                    else
                                    {
                                        @:--
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <!-- Premium collection -->
        <div class="sd-section-card">
            <div class="sd-section-header">
                <div>
                    <div class="sd-section-title">Premium Collection Preview</div>
                    <div class="sd-section-sub">
                        A quick look at some premium titles.
                    </div>
                </div>
                <a asp-controller="Student"
                   asp-action="PremiumCollection"
                   class="sd-btn-soft">
                    View Premium Collection
                </a>
            </div>

            @if (Model.PremiumBooksSample == null || !Model.PremiumBooksSample.Any())
            {
                <p>No premium books configured yet.</p>
            }
            else
            {
                <table class="sd-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var book in Model.PremiumBooksSample)
                        {
                            <tr>
                                <td>@book.Title</td>
                                <td>@book.Author</td>
                                <td>@book.Category</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

    </div>
</div>
