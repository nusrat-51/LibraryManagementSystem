@model LibraryManagementSystem.Controllers.StudentDashboardViewModel

@{
    Layout = "~/Views/Shared/_StudentLayout.cshtml";
    ViewData["Title"] = "Student Dashboard";
}

<div class="dashboard-page">
    <h1 class="page-title">Student Dashboard</h1>
    <p class="text-muted">
        Welcome, @Model.StudentName (@Model.Email)
    </p>

    <!-- Membership + Summary -->
    <div class="dashboard-grid">
        <!-- Membership card -->
        <div class="card">
            <div class="card-body">
                <h3 class="section-title">Membership</h3>

                <div class="membership-info">
                    <p><strong>Email:</strong> @Model.Email</p>
                    <p><strong>Type:</strong> @Model.MembershipType</p>
                    <p>
                        <strong>Status:</strong>
                        @(Model.IsMembershipActive ? "Active" : "Inactive")
                    </p>

                    <hr />

                    <p><strong>Membership ID / Barcode</strong><br />
                        @Model.MembershipBarcode
                    </p>

                    <p>
                        <strong>Expiry:</strong>
                        @(Model.MembershipExpiry?.ToString("dd MMM yyyy") ?? "N/A")
                    </p>

                    <form asp-action="UpgradeToPremium" method="post">
                        <button type="submit" class="btn-primary">
                            @(Model.HasPremiumAccess ? "Renew Premium" : "Upgrade to Premium")
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Stats cards -->
        <div class="stats-grid">
            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-label">Current Issued</div>
                    <div class="stat-value">@Model.CurrentIssuedCount</div>
                </div>
            </div>

            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-label">Overdue</div>
                    <div class="stat-value">@Model.OverdueCount</div>
                </div>
            </div>

            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-label">Total Books</div>
                    <div class="stat-value">@Model.TotalBooksCount</div>
                </div>
            </div>

            <div class="card stat-card">
                <div class="card-body">
                    <div class="stat-label">Unpaid Fine</div>
                    <div class="stat-value">@Model.TotalUnpaidFine.ToString("0.00")</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent issued books -->
    <div class="card mt-2">
        <div class="card-body">
            <div class="section-header">
                <h3 class="section-title">Recent Issued Books</h3>
                <a asp-action="MyIssues" class="link-small">View All</a>
            </div>

            @if (Model.RecentIssues == null || !Model.RecentIssues.Any())
            {
                <p class="text-muted">You have no issued books yet.</p>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Book</th>
                                <th>Issued On</th>
                                <th>Status</th>
                                <th>Return Date</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var issue in Model.RecentIssues)
                        {
                            <tr>
                                <td>@issue.Book?.Title</td>
                                <td>@issue.IssueDate.ToShortDateString()</td>
                                <td>@issue.Status</td>
                                <td>@(issue.ReturnDate?.ToShortDateString() ?? "-")</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <!-- Premium collection preview -->
    <div class="card mt-2">
        <div class="card-body">
            <div class="section-header">
                <div>
                    <h3 class="section-title">Premium Collection Preview</h3>
                    <p class="text-muted mb-0">A quick look at some premium titles.</p>
                </div>
                <a asp-action="PremiumCollection" class="link-small">
                    View Premium Collection
                </a>
            </div>

            @if (Model.PremiumBooksSample == null || !Model.PremiumBooksSample.Any())
            {
                <p class="text-muted">No premium books available yet.</p>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Category</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var book in Model.PremiumBooksSample)
                        {
                            <tr>
                                <td>@book.Title</td>
                                <td>@book.Author</td>
                                <td>@book.Category</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>
